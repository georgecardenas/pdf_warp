\chapter{Descripción informática}
En este capítulo se realiza un análisis del proceso de desarrollo del proyecto, explicando la aplicación de la metodología, los hitos cumplidos en el desarrollo del proyecto e incluyendo toda la información relevante sobre el funcionamiento de la aplicación.
\section{Aplicación de la metodología Scrum}
\label{sec:metscrum}
En este proyecto se aplica la metodología Scrum adaptada a \ac{TFM} como hemos explicado en el apartado \ref{sec:scrumtfm}. El tutor del proyecto toma el rol de propietario del producto y el alumno de desarrollador. El rol de \textit{Scrum Master} se divide entre tutor y alumno.

\subsection{Primera reunión 04/05/2017}
En la primera reunión se trata todo lo referente al inicio del proyecto. El propietario del producto explica al desarrollador cual es el objetivo final del \ac{TFM}: desarrollar un módulo para Drupal para la generación de PDF a partir de catálogos y productos de Ubercart. Se dan también los primeros detalles que debería contener la herramienta.
Debido a que el desarrollador desconoce Drupal, se crea la primera tarea técnica de instalación, gestión y estudio de este \textit{framework}. A partir de este backlog se establece el primer \textit{sprint} (cuadro \ref{tab:sb01}) y se da un plazo de 2 a 3 semanas para terminarlo. En el cuadro \ref{tab:pb01} se puede observar el estado del product backlog tras la primera reunión.

\begin{table}
	\centering
	\begin{tabular}{ | p{2cm} | p{3cm} | p{7.5cm} | p{1cm} |}
		\hline
		ID Historia & Alias & Enunciado & \textit{Sprint}\\ \hline
		HT01 & Instalación de Entorno & Yo como desarrollador\newline necesito montar un entorno de Drupal 7\newline para poder desarrollar la aplicación & \#1\\ \hline
	\end{tabular}
	\caption{\textit{Product Backlog} 04/05/2017}\label{tab:pb01}
\end{table}

\begin{table}
	\centering
	\begin{tabular}{ | p{2cm} | p{2cm} | p{7cm} | p{2cm} |}
		\hline
		ID Historia & ID Tarea & Descripción & Esfuerzo\\ \hline
		HT01 & TT01.1 & Instalar Drupal 7 & 8\\ \hline
		HT01 & TT01.2 & Instalar base de datos & 8\\ \hline
		HT01 & TT01.3 & Instalar módulo & 5\\ \hline
		HT01 & TT01.4 & Instalar tema & 5\\ \hline
		HT01 & TT01.5 & Crear contenido & 3\\ \hline
		HT01 & TT01.6 & Crear tipos de contenido & 3\\ \hline
		HT01 & TT01.7 & Crear bloques & 2\\ \hline
		HT01 & TT01.8 & Crear vistas & 2\\ \hline
	\end{tabular}
	\caption{\textit{Sprint} \#1}\label{tab:sb01}
\end{table}

\subsection{Segunda reunión 25/05/2017}
En la segunda reunión se muestra al propietario del producto las tareas realizadas con resultado satisfactorio. Al haber completado con éxito el primer \textit{sprint} y haber demostrado el desarrollador soltura a la hora de utilizar el \textit{framework} de Drupal, se comienza a hablar de la funcionalidad que debe cumplir el \ac{TFM}. Se establecen nuevas historias de usuario para el \textit{product backlog} estableciendo como prioritarias aquellas relacionadas con la generación de documentos PDF. Se establece el nuevo \textit{sprint} (cuadro \ref{tab:sb02}) y se establece una duración de una semana. El \textit{product backlog} en este punto se puede observar en el cuadro \ref{tab:pb02}

\begin{table}
	\centering
	\begin{tabular}{ | p{2cm} | p{3cm} | p{7.5cm} | p{1cm} |}
		\hline
		ID Historia & Alias & Enunciado & \textit{Sprint}\\ \hline
		HT01 & Instalación de Entorno & Yo como desarrollador\newline necesito montar un entorno de Drupal 7\newline para poder desarrollar la aplicación & \#1\\ \hline
		H01 & Botón de generación de PDF de producto & Yo como usuario\newline necesito ver un botón de generación de PDF para Productos\newline para poder generar un documento PDF & \#2\\ \hline
		H02 & Generación de PDF de producto & Yo como usuario\newline debo ser capaz de generar PDF a partir de Productos\newline para su posterior consulta offline & \#2\\ \hline
		HT02 & Creación de vistas programáticamente & Yo como desarrollador\newline debo crear las vistas JSON del módulo programáticamente\newline para que el usuario no tenga que realizar trabajo extra en la fase de instalación & \#2\\ \hline
	\end{tabular}
	\caption{\textit{Product Backlog} 25/05/2017}\label{tab:pb02}
\end{table}

\begin{table}
	\centering
	\begin{tabular}{ | p{2cm} | p{2cm} | p{7cm} | p{2cm} |}
		\hline
		ID Historia & ID Tarea & Descripción & Esfuerzo\\ \hline
		H01 & T01.1 & Crear Hooks & 2\\ \hline
		H02 & T02.1 & Integrar librería pdf & 5\\ \hline
		H02 & T02.2 & Programar funciones de conversión a PDF según la librería & 8\\ \hline
		H02 & T02.3 & Añadir funcionalidad a botón H02 & 2\\ \hline
		HT02 & TT02.1 & Añadir vistas por código en el fichero de instalación & 5\\ \hline
	\end{tabular}
	\caption{\textit{Sprint} \#2}\label{tab:sb02}
\end{table}

\subsection{Tercera reunión 01/06/2017}
Tras la implementación del segundo \textit{sprint} se lleva a cabo la revisión de las tareas realizadas. En este momento el propietario del producto informa que hay nuevas historias de usuario que implican cambios en la idea inicial del procedimiento. Además de la generación PDF, debe ser posible que un usuario administrador cree y gestione nuevas plantillas que serán aplicadas en el momento de la generación. Se pide también que además de la generación de PDF de productos independientes se implemente la generación de PDF de catálogos de productos. Al haber demasiadas historias de usuario para el siguiente \textit{sprint} (ver cuadro \ref{tab:pb03}) se decide dividir las tareas en dos \textit{sprints} que serán ejecutados en sucesión. La definición del tercer \textit{sprint} se puede ver en el cuadro \ref{tab:sb03} la duración del mismo será de 2 semanas.

\begin{table}
	\centering
	\scriptsize{
	\begin{tabular}{ | p{2cm} | p{3cm} | p{7.5cm} | p{1cm} |}
		\hline
		ID Historia & Alias & Enunciado & \textit{Sprint}\\ \hline
		HT01 & Instalación de Entorno & Yo como desarrollador\newline necesito montar un entorno de Drupal 7\newline para poder desarrollar la aplicación & \#1\\ \hline
		H01 & Botón de generación de PDF de producto & Yo como usuario\newline necesito ver un botón de generación de PDF para Productos\newline para poder generar un documento PDF & \#2\\ \hline
		H02 & Generación de PDF de producto & Yo como usuario\newline debo ser capaz de generar PDF a partir de Productos\newline para su posterior consulta offline & \#2\\ \hline
		HT02 & Creación de vistas programáticamente & Yo como desarrollador\newline debo crear las vistas JSON del módulo programáticamente\newline para que el usuario no tenga que realizar trabajo extra en la fase de instalación & \#2\\ \hline
		H03 & Creación de plantillas de producto & Yo como administrador\newline debo ser capaz de crear plantillas para la generación de PDFs de Productos\newline para que el usuario genere un PDF atractivo & \#3\\ \hline
		H04 & Asignación de plantillas de producto & Yo como administrador\newline necesito poder asignar una plantilla de PDF a Productos\newline para que se genere un PDF con los elementos posicionados de acorde a la plantilla & \#3\\ \hline
		H05 & Mover elementos en plantillas de producto & Yo como administrador\newline necesito poder mover elementos en una plantilla pdf de producto\newline para posicionarlos donde crea conveniente & \#3\\ \hline
		H06 & Borrado de plantillas de producto & Yo como administrador\newline debo ser capaz de borrar plantillas PDF de producto\newline para que no se acumulen plantillas sin uso & \#2\\ \hline
		H07 & Acceso a sección de gestión de plantillas & Yo como administrador\newline necesito un botón en la sección de admnistración\newline para poder acceder a la sección de gestión de plantillas & \#3\\ \hline
		H08 & Botón de generación de PDF de catálogo & Yo como usuario\newline necesito ver un botón de generación de PDF para catálogos\newline para poder generar un documento PDF & \#4\\ \hline
		H09 & Generación de PDF de catálogo & Yo como usuario\newline debo ser capaz de generar PDFs a partir de catálogos\newline para su posterior consulta offline & \#4\\ \hline
		H10 & Creación de plantillas de catálogo & Yo como administrador\newline debo ser capaz de crear plantillas para la generación de PDFs de catálogos\newline para que el usuario genere un PDF atractivo & \#4\\ \hline
		H11 & Asignación de plantillas de catálogo & Yo como administrador\newline necesito poder asignar una plantilla de PDF a catálogos\newline para que se genere un PDF con los elementos posicionados de acorde a la plantilla & \#4\\ \hline
		H12 & Mover elementos en plantillas de catálogo & Yo como administrador\newline necesito poder mover elementos en una plantilla pdf de catálogo\newline para posicionarlos donde crea conveniente & \#4\\ \hline
		H13 & Borrado de plantillas de catálogo & Yo como administrador\newline debo ser capaz de borrar plantillas PDF de catálogo\newline para que no se acumulen plantillas sin uso & \#4\\ \hline
	\end{tabular}}
	\caption{\textit{Product Backlog} 01/06/2017}\label{tab:pb03}
\end{table}

\begin{table}
	\centering
	\begin{tabular}{ | p{2cm} | p{2cm} | p{7cm} | p{2cm} |}
		\hline
		ID Historia & ID Tarea & Descripción & Esfuerzo\\ \hline		
		H03 & T03.1 & Crear tablas de base de datos & 8\\ \hline
		H03 & T03.2 & Crear vistas de administración & 8\\ \hline
		H03 & T03.3 & Crear funciones en \textit{back-end} de creación de plantillas & 5\\ \hline
		H04 & T04.1 & Crear funciones \textit{back-end} para la asignación de plantillas & 5\\ \hline
		H04 & T04.2 & Crear vista para la asignación de plantillas & 5\\ \hline
		H05 & T05.1 & Integración de librerías \textit{front-end} & 8\\ \hline
		H05 & T05.2 & Creación de vistas & 3\\ \hline
		H05 & T05.3 & Funciones de edición & 8\\ \hline
		H05 & T05.4 & Funciones de actualización de base de datos & 5\\ \hline
		H06 & T06.1 & Vistas para borrado & 3\\ \hline
		H06 & T06.2 & Funciones de borrado de base de datos & 3\\ \hline
		H07 & T07.1 & Creación de botón en \textit{back-end} & 5\\ \hline
	\end{tabular}
	\caption{\textit{Sprint} \#3}\label{tab:sb03}
\end{table}

\subsection{Cuarta reunión 16/06/2017}
Se lleva a cabo la cuarta reunión revisando las tareas realizadas en el tercer \textit{sprint}. El resultado es satisfactorio y se planifica el siguiente conjunto de tareas a realizar a partir de las historias de usuario restantes en el \textit{product backlog}. Se define el \textit{sprint} del cuadro \ref{tab:sb04} mientras se mantiene el estado actual del \textit{product backlog} del cuadro \ref{tab:pb03}. la complejidad de estas tareas es menor, ya que están muy relacionadas con las tareas del tercer \textit{sprint} y la experiencia previa, permite que el tiempo asignado para estas tareas sea de una semana.

\begin{table}
	\centering
	\begin{tabular}{ | p{2cm} | p{2cm} | p{7cm} | p{2cm} |}
		\hline
		ID Historia & ID Tarea & Descripción & Esfuerzo\\ \hline
		H08 & T08.1 & Crear Hooks & 2\\ \hline
		H09 & T09.1 & Programar funciones de conversión a PDF según la librería & 5\\ \hline
		H09 & T09.2 & Añadir funcionalidad a botón H02 & 2\\ \hline
		H10 & T10.1 & Crear vistas de administración & 5\\ \hline
		H10 & T10.2 & Crear funciones en back-end de creación de plantillas & 5\\ \hline
		H11 & T11.1 & Crear funciones back-end para la asignación de plantillas & 5\\ \hline
		H11 & T11.2 & Crear vista para la asignación de plantillas & 5\\ \hline
		H12 & T12.1 & Creación de vistas & 3\\ \hline
		H12 & T12.2 & Funciones de edición & 5\\ \hline
		H12 & T12.3 & Funciones de actualización de base de datos & 5\\ \hline
		H13 & T13.1 & Vistas para borrado & 3\\ \hline
		H13 & T13.2 & Funciones de borrado de base de datos & 3\\ \hline
	\end{tabular}
	\caption{\textit{Sprint} \#4}\label{tab:sb04}
\end{table}

\subsection{Quinta reunión 23/06/2017}
Se muestran los resultados de la implementación de las tareas del cuarto \textit{sprint}. El resultado es satisfactorio y se continúa con la elaboración de la documentación para el ac{TFM}.

\section{Desarrollo del proyecto}
En esta sección se expondrá el proceso de desarrollo del \ac{TFM}. Según lo expuesto en la sección \ref{sec:metscrum}, el desarrollo está dividido en cuatro \textit{sprints} y cada uno de ellos consta de diseño, desarrollo y pruebas.

\subsection{Primer \textit{sprint}}
Como se puede observar en el cuadro \ref{tab:sb01}, el primer \textit{sprint} tiene sólo una historia de usuario: ``Instalación de Entorno'', que comprende ocho tareas básicas para desplegar y comprender el funcionamiento de un entorno Drupal.

\subsubsection{Requisitos de Drupal}
Para poder ejecutar una aplicación Drupal se tienen que cumplir los siguientes requisitos:
\begin{itemize}  
	\item Espacio en disco mínimo de 60MB.
	\item Servidor web con soporte PHP como Apache, Nginx ó Microsoft IIS.
	\item Base de datos MySQL, MariaDB, Percona Server, PostgreSQL o SQLite.
	\item PHP 5.2.5 mínimo
\end{itemize}
Se decide utilizar una infraestructura \acf{WAMP} con lo que se cumplen todos los requisitos mínimos de Drupal. El esquema de WAMP se puede ver en la figura \{****** incluir imagen *****\}.
Realizar una instalación para \ac{WAMP} es sencillo, simplemente hay que descargar un instalador de la página web de \ac{WAMP}\footnote{http://www.wampserver.es/} y seguir los pasos del wizard de instalación como se puede observar en la figura \{**** imagen del wizard****\}. Una vez completada la instalación, se arrancan los servicios de \ac{WAMP} navegando a la carpeta de instalación y ejecutando {*** ejecutable ***}.

\subsubsection{Instalación de Drupal}
Hay varias formas para instalar Drupal y sus extensiones. Inicialmente se intentó usar la herramienta Composer con la cual poder crear un archivo composer.json con todos los parámetros de la instalación de Drupal, incluyendo módulos extra, y posteriormente ejecutar la instalación con un único comando de consola. Sin embargo, tras múltiples problemas relacionados con la plataforma Windows elegida, y, dado que el proceso de instalación de Drupal en sí no está incluído dentro del alcance de los propósito del \ac{TFM}, se decidió utilizar un proceso de instalación manual.\\

Para instalar Drupal manualmente, el proceso es el siguiente:
\begin{enumerate}  
	\item Descargar y extraer Drupal: El \textit{framework} no requiere instalación propiamente dicha, tan sólo hace falta descargar el archivo comprimido de la web de Drupal\footnote{https://www.drupal.org/project/drupal} y extraer los ficheros comprimidos dentro de la carpeta de aplicaciones web en la instalación de \ac{WAMP}.
	\item Crear base de datos: En el servidor de MySQL incluido en \ac{WAMP}, se crea la base de datos para la aplicación de Drupal.
	\item Ejecución de scripts de Drupal: Finalmente se navega a la aplicación creada en el punto 1 (ejemplo: http://localhsot/drupal) y se siguen los pasos para completar la instalación. Esto ejecutará los scripts necesarios para completar la instalación de Drupal como se puede ver en la figura \{****** incluir imagen de instalación de Drupal *****\}.
\end{enumerate}

\subsubsection{Expandiendo Drupal}
Como \ac{CMS}, Drupal contiene mecanismos para que un administrador pueda agregar contenido y funcionalidad extra. Esto se realiza desde los menús de administración en la aplicación web. Para acceder a esta sección, se navega a la aplicación web del servidor local (creado en la sección anterior) y se introducen los credenciales de un usuario con privilegios, creado en el paso 3 de la instalación manual de Drupal. En la figura \{****** insertar imagen administracion ****\} se puede ver el menú de administración.\\

Las siguientes acciones sobre la instalación de Drupal se han llevado a cabo para el primer \textit{sprint}:
\begin{itemize}  
	\item Instalación de módulo: Para instalar un módulo de Drupal manualmente, hay que realizar una búsqueda del mismo en su web\footnote{https://www.drupal.org/project/project\_module} y descargar su fichero comprimido. Una vez descargado, se añade el módulo a Drupal mediante la opción ``Install new module'' del menú ``Modules'' como se puede observar en la figura \{****** menú modules ****\}. Una vez añadido, el módulo y sus dependencias, se activa desde la lista de módulos, como se muestra en la figura \{**** Lista de módulos ****\}. Para ganar tiempo en el futuro del desarrollo, se instala directamente el módulo de Ubercart y sus dependencias.
	\item Instalación de tema: Se instala el tema Acquia Prosper de manera manual. Para ello se realiza una búsqueda en la web de descarga de temas\footnote{https://www.drupal.org/project/project\_theme} y se obtiene el fichero comprimido. Luego desde la sección ``Appearance'', se elige la opción ``Install new theme'' y se elige el archivo descargado como se puede ver en la figura \{***** imagen de appearance ****\}. Por último se instalan us dependencias y se activa desde el listado de temas de la sección ``Appearance''.
	\item Creación de contenido: Se crean contenidos, tipos de contenido, vistas y bloques de prueba para familiarizarse con la diferente funcionalidad de Drupal y productos para el posterior desarrollo del proyecto.
\end{itemize}

\subsubsection{Creación de un módulo de Drupal}
Para crear un nuevo módulo de Drupal 7, se navega a la carpeta ``sites/all/modules/'' de la instalación de Drupal, y se crea un nuevo directorio con el nombre de la nueva extensión que en este caso será ``pdf\_warp''. En este nuevo directorio se crea un fichero ``pdf\_warp.info'' con el siguiente contenido:
\begin{verbatim}
    name = PDF Warp
    description = A module that provides Drupal 7 with PDF functionality for Ubercart
    core = 7.x
    package = PDF Warp
\end{verbatim}
Esto indicará a Drupal las propiedades básicas del nuevo módulo para que lo reconozca como tal y se pueda activar desde el menú ``Modules'' de la administración.\\

Por último se crea en el directorio un fichero pdf\_warp.module que tendrá el código PHP con la funcionalidad de la extensión.

\subsection{Segundo \textit{sprint}}
Este \textit{sprint} consta de tres historias de usuario que se dividen en cinco tareas, como está reflejado en el cuadro \ref{tab:sb02}. A partir de este punto empieza el desarrollo de la funcionalidad del \ac{TFM}.

\subsubsection{Diseño}
La arquitectura del módulo constará de un directorio base que contiene el archivo .info de descripción del módulo, el archivo .install con las instrucciones PHP a ejecutar durante la instalación, el archivo .module que contiene el código del módulo como la implementación de \textit{hooks} de Drupal y los archivos .tpl con las plantillas de PHP. Dentro del mismo directorio y como se puede observar en la figura \{***** imagen carpetas ****\} se incluirán una carpeta ``css'' para los estilos del módulo y una carpeta ``js'' para todo el contenido \textit{front-end} dinámico.\\

La aplicación inicialmente seguirá el diseño de la figura \{**** arquitectura inicial ****\} con Drupal como fuente de datos, y comunicaciones JSON con el \textit{front-end} para la generación de PDF.

\subsubsection{Desarrollo}
\begin{itemize}  
	\item \textbf{H01 ``Botón de generación de PDF de producto''}\\
	Se decide abordar de principio la historia de usuario H01 ``Botón de generación de PDF de producto'' ya que presenta menor complejidad y es más necesaria para la interacción humano/máquina. Para mostrar un botón en los productos de Ubercart, es necesario implementar el \textit{hook} \textit{form\_alter} en el archivo .module. Esta es la función a la que Drupal llama cada vez que pinta un formulario, de modo que se usará para comprobar si se está renderizando un formulario de producto de Ubercart y, de este modo, añadir el botón ``Generar PDF'' a cada producto. El código de este \textit{hook} es el siguiente:
	\begin{verbatim}
	    function pdf_warp_form_alter(&$form, $form_state, $form_id){
	      if (strpos($form_id, 'uc_product_add_to_cart_form') !== false) {
	        $form['to_pdf_button'] = array(
	          '#type' => 'submit',
	          '#value' => t('Generar PDF'),
	          '#submit' => array('pdf_warp_goto_generation')
	        );
	      }
	    }
	\end{verbatim}
	En dónde \textit{\&\$form} contiene la información del formulario que se está renderizando, \textit{\$form\_state} contiene la información del estado de formulario y \textit{\$form\_id} contiene el id de formulario.\\
	\item \textbf{HT02 ``Creación de vistas programáticamente''}\\
	Se necesita crear las vistas de producto y catálogo en JSON para que el código Javascript del cliente pueda trabajar con estos datos. Para ello se hace uso de los \textit{hooks} \textit{views\_api} y \textit{views\_default\_views}. Debido a que crear una vista programáticamente es complicado, lo más sencillo es crear la vista de forma manual y luego exportar el código generado a \textit{views\_default\_views} como se observa en la figura \{***** imagen de exportación*****\}
	\begin{verbatim}
	function pdf_warp_views_api() {
	  return array(
	    'api' => 3.0,
	    'path' => drupal_get_path('module', 'pdf_warp')
	  );
	}
	
	functionpdf_warp_views_default_views() {
	  // Pegar código de la exportación
	
	  $views[$view->name] = $view;
	  return $views;
	}
	\end{verbatim}
	\item \textbf{H02 ``Generación de PDF de producto''}\\
	Tras concluir la implementación de la historia H01 y HT02, se empieza con la H02 ``Generación de PDF de producto''. En esta historia de usuario se necesita añadir las librerías de generación de PDF, implementar la funcionalidad del lado del cliente y agregar el lanzado de la generación al botón de la historia H01.\\
	
	Para no sobrecargar las páginas de Drupal con librerías que no necesitan, se cargará el código Javascript localmente en las páginas en las que sea necesario. Con este fin, se crea una nueva página que realizará la generación de PDF.\\
	El proceso de creación de una nueva página requiere implementar los \textit{hooks} \textit{menu} y \textit{theme} en el archivo .module. Estas funciones son llamadas por Drupal cuando se va a generar el árbol de navegación y los temas.\\
	
	En el \textit{hook} \textit{menu}, se añade un nuevo elemento al \textit{array} \$items con su título, descripción, \textit{callback}, argumentos de página y privilegios necesarios para acceder. La implementación es la siguiente:
	\begin{verbatim}
    function pdf_warp_menu() {
      $items['pdf_warp/generate/product/%'] = array(
       'title'            => 'PDF Warp generación',
       'description'      => 'Generación de PDF',
       'page callback'    => 'pdf_warp_generate_product_page',
       'page arguments'   => array(3),
       'access arguments' => array('access content'),
      );
    }
	\end{verbatim}
	En este caso se establece que se está creando una página de título ``PDF Warp generación'', con llamada función de .module ``pdf\_warp\_generate\_product\_page'' en el paso previo a su renderizado, con un argumento que viene dado por el índice 3 de la url y que se requiere el privilegio de acceso a contenido para su navegación.\\
	
	Para el \textit{hook} \textit{theme} se devuelve un array de elementos que contienen un atributo \textit{template} con el nombre del fichero dentro del directorio del módulo que contiene el código de dicha plantilla:
	\begin{verbatim}
	    function pdf_warp_theme(){
	      return array(
	        'pdf_warp_generation' => array (
	          'template' => 'pdf-warp-generation'
	        )
	      );
	    }
	\end{verbatim}
	
	Teniendo los hooks, se programa la función ``pdf\_warp\_generate\_product\_page''. Esta función tiene un argumento que será el contenido de ``page arguments''. Aquí se realiza la inyección de las librerías de Javascript con el uso de drupal\_add\_js:
	\begin{verbatim}
    function pdf_warp_generate_product_page($id_item) {
      $path = drupal_get_path('module', 'pdf_warp');
      
      drupal_add_js($path.'/js/pdf_warp_generation.js');
      drupal_add_js($path.'/js/vendor/jspdf.min.js');
      drupal_add_js($path.'/js/vendor/html2pdf.js');

      return theme('pdf_warp_generation');
    }
    \end{verbatim}
    Una vez integradas las librerías de Javascript en Drupal se procede a implementar las funciones de generación PDF en el lado del cliente. Para ello se crea dentro de la carpeta ``js'' de pdf\_warp un fichero pdf\_warp\_generation.js que ya estamos referenciando en la función anterior.
    En este fichero se hace uso de las librerías de JsPDF para generar un documento PDF del producto con id \$id\_item. Para conseguir los datos de este producto en JSON, se hace uso de las vistas definidas previamente mediante una llamada ajax a:
    \begin{verbatim}
      base_url + '/store/catalog/' + id + '/json'
    \end{verbatim}
    siendo \textit{base\_ur}l la url de base de la aplicación Drupal e \textit{id} el id del producto. Con esta información en el Javascript se puede generar un pdf de manera programática haciendo uso de las funciones de la librería JsPDF:
    \begin{verbatim}
        var doc = new jsPDF('portrait','pt','a4');
        var pdf_elements = vm.initTemplate.pdf_elements
        doc.setFontSize(16 * 72 / 96);
        doc.text(pdf_elements[key].x * 72 / 96 + 40 * 72 / 96,
            pdf_elements[key].y * 72 / 96 + 40 * 72 / 96,
            product[index].product.Title
        );
        doc.setFontSize(10 * 72 / 96);
        doc.text(pdf_elements[key].x * 72 / 96 + 40 * 72 / 96,
            pdf_elements[key].y * 72 / 96 + 60 * 72 / 96, 
            'SKU:' + product[index].product.SKU
        );
        doc.setFontSize(22 * 72 / 96);
        doc.text(pdf_elements[key].x * 72 / 96 + 100 * 72 / 96,
            pdf_elements[key].y * 72 / 96 + 300 * 72 / 96,
            product[index].product.Price
        );
        doc.save('producto.pdf');
    \end{verbatim}
    
    Con esta funcionalidad, al hacer click en el botón se generará un PDF del producto asociado a dicho botón.
\end{itemize}

\subsubsection{Pruebas}
Las pruebas realizadas son las siguientes:
\begin{itemize}
	\item Se comprueba que el botón ``Generar PDF'' únicamente se genera para los productos.
	\item Se prueba el botón de ``Generar PDF '' de cada producto para comprobar que se generan documentos PDF distintos en función del producto al que pertenecen.
	\item Se comprueba que las vistas en JSON devuelven el contenido correcto de un producto.
	\item Se comprueba que los \textit{hooks} implementados funcionan correctamente.
\end{itemize}

\subsection{Tercer \textit{sprint}}

\subsection{Cuarto \textit{sprint}}